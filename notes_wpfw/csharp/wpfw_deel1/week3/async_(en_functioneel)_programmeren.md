> Note: Functioneel programmeren met #delegate en Func<> zullen niet worden beschreven.

# Intro

Hier vind je de onderdelen van lesweek3. Alles wat je moet weten van deze week wat ook in het #toetsmatrijs staat beschreven. Als er een stukje staat met dat er nog later uitleg komt, dan vul ik dat later in. Er is geen garantie dat #code  perfect is. Daar gaat het niet om. Als je de #code  shit vindt, dan snap je niet het punt, want het gaat puur om het concept. 

Als je de concepten begrijpt, dan ben je al een stap vooruit. Voor vragen of opmerkingen kun je me altijden dmen op #Discord: redisgaming of #Whatsapp. Deze intro zal ook in de andere documenten als intro staan, dus al je dit hebt gelezen, kun je de intro H1 skippen. Voor de rest ben ik meer gefocust op voorbeelden dan op het uitleggen. Houdt daar rekening mee. Good luck :)

> Note: De uitleg is in het Nederlands. De code en H2/H3 in het Engels.

## Async programming with #await and #Task

### Async #class Example

We hebben hier een DownloadSource #class met 2 methods. Ze lijken beide op elkaar en violaten meerdere #OOP regels, maar das niet belangrijk hier. We maken een DownloadAsync method met het type #Task. Let daarbij op dat async #void geen goeie manier is om een method te maken. Aangezien de #Task een #collection is van asynchroon programmeren.

Om asynchroon te kunnen programmeren, gebruiken we het keyword: async. Bij synchroon programmeren wordt alles tegelijk uitgevoerd. Bij Asynchroon heb je verschillende #threads die anders om gaan met bepaalde taken. We printen de eerste #Console regel uit. Daarna voeren we de regel uit: #await #Task .Delay(3000). Hierdoor wacht het programma 3 seconden lang.

```C#
namespace ConsoleApp3;  
  
public class DownloadSource  
{  
  private const int TOTAL = 50; //const to be used for this program.
    
  public async Task DownloadAsync()  
  {  
    Console.WriteLine("Awaiting downloads...");  
    await Task.Delay(3000);  
    var source = new List<string> { "Downloading from Source" };  
    var download = Enumerable.Range(0, TOTAL);  
  
    foreach (var downloads in download)  
    {  
      var result = await Task.Run(() => source  
        .Select((value, number) => new { Value = value, Number = number })
        .OrderBy(d => d.Value)  
        .ToList());  
        
      result.ForEach(d =>  
      {  
        Console.WriteLine($"Task: {source[d.Number]} {downloads + 1}...");  
        Task.Delay(150).Wait();  
      });  
    }  
  
    await Task.CompletedTask;  
  }  
  
  public async Task SourceAsync()  
  {  
    await Task.Delay(1500);  
    var process = new List<string> { "Processing data from Source" };  
    var download = Enumerable.Range(0, TOTAL);  
  
    foreach (var processes in download)  
    {  
      var result = await Task.Run(() => process  
        .Select((value, number) => new { Value = value, Number = number})  
        .OrderBy(p => p.Value)  
        .ToList());  
        
      result.ForEach(p =>  
      {  
        var random = new Random().Next(1, TOTAL);  
        Console.WriteLine($"Process: {process[p.Number]} {processes + 1} {random}MB / {random}MB...");  
        Task.Delay(75).Wait();  
      });  
    }  
      
    Console.WriteLine("All downloads and processes completed!!!");  
    await Task.CompletedTask;  
  }
}

```

We zijn niet verplicht om #await ervoor te zetten, maar de waarschuwing geeft het volgende aan: <span style=color:#FFA500>Because this call is not awaited, execution of the current method continues before the call is completed. Consider applying the 'await' operator to the result of the call.</span> Daarna maken we een nieuwe #List aan met een #List Initializer met de waarde: "Downloading from Source".

We maken ook een variabele aan met type #var waarin een #Enumerable Range tussen de 0-50 zit. Die wordt 50x aangeroepen in de #foreach loop. Vervolgens maken we een result #var aan met een #Task .Run. Hierin voeren we de code welke we willen runnen. We gebruiken #linq met de #Select #OrderBy en de #ToList. In de #Select maken we een anonieme type.

Deze bevat de #key-value variant en die geven we mee aan de #Properties . Om #side-effects te voorkomen zetten we de #foreach #linq apart neer. Daarin zetten we de taken uit de #List neer met het nummer 1 tot en met 50. Een index begint met 0, dus tellen we er 1 bij op. Als laatste roepen we #Task.Delay(150).Wait() aan. 

Als je de .Wait() weghaald, dan zullen alle elementen tegelijk op het scherm komen, desondanks dat de #Task .Run awaited wordt. De SourceAsync method heeft dezelfde opbouw, dus dat is eigenlijk precies hetzelfde, alleen zijn er wat namen anders en voegen we een #Random toe met #Next. Daarbij krijg je een random getal tussen 1-50. 

>Dit heb ik gedaan om het downloaden te simuleren en de processen komen 2x zo snel. Daarna stopt het programma.

### #Task #List All

> Hier vind je de volledige lijst van de #Task methods die er zijn. Er zijn er in totaal 15.

```C#
CompletedTask //Task
CurrentId //int?
Factory //TaskFactory
Delay //Task
FromCanceled<> //Task<TResult>
FromCanceled //Task
FromException //Task
FromException<> //Task<TResult>
FromResult //Task<TResult>
Run //Task
WaitAll //void
WaitAny //int
WhenAll //Task
WhenAny //Task<Task>
Yield //YieldAwaitable
```

> Je hoeft niet alles uit je hoofd te kennen. Waarschijnlijk zul je zelf maar maximaal 3 nodig hebben. Delay, Run en CompletedTask gebruik je het meest. Maar FromResult kan handig zijn als je in een synchroon programma werkt, waarin je niet met async en #await bezig bent.

### Running Main Program

```C#
namespace ConsoleApp3;  
  
public class Program  
{  
  public static async Task Main()  
  {  
    var async = new DownloadSource();  
    await async.DownloadAsync();  
    Console.WriteLine("Awaiting processes...");  
    await async.SourceAsync();  
  }  
}

```

> Hier roepen we de objecten aan. Nadat de downloads klaar zijn, zie je: Awaiting processes... verschijnen. Dit heeft een vertraging van 1,5 seconden.

### Result Async Program

```C#
Awaiting downloads...
Task: Downloading from Source 1...
Task: Downloading from Source 2...
Task: Downloading from Source 3...
Task: Downloading from Source 4...
Task: Downloading from Source 5...
Task: Downloading from Source 6...
Task: Downloading from Source 7...
Task: Downloading from Source 8...
Task: Downloading from Source 9...
Task: Downloading from Source 10...
Task: Downloading from Source 11...
Task: Downloading from Source 12...
Task: Downloading from Source 13...
Task: Downloading from Source 14...
Task: Downloading from Source 15...
Task: Downloading from Source 16...
Task: Downloading from Source 17...
Task: Downloading from Source 18...
Task: Downloading from Source 19...
Task: Downloading from Source 20...
Task: Downloading from Source 21...
Task: Downloading from Source 22...
Task: Downloading from Source 23...
Task: Downloading from Source 24...
Task: Downloading from Source 25...
Task: Downloading from Source 26...
Task: Downloading from Source 27...
Task: Downloading from Source 28...
Task: Downloading from Source 29...
Task: Downloading from Source 30...
Task: Downloading from Source 31...
Task: Downloading from Source 32...
Task: Downloading from Source 33...
Task: Downloading from Source 34...
Task: Downloading from Source 35...
Task: Downloading from Source 36...
Task: Downloading from Source 37...
Task: Downloading from Source 38...
Task: Downloading from Source 39...
Task: Downloading from Source 40...
Task: Downloading from Source 41...
Task: Downloading from Source 42...
Task: Downloading from Source 43...
Task: Downloading from Source 44...
Task: Downloading from Source 45...
Task: Downloading from Source 46...
Task: Downloading from Source 47...
Task: Downloading from Source 48...
Task: Downloading from Source 49...
Task: Downloading from Source 50...
Awaiting processes...
Process: Processing data from Source 1 27MB / 27MB...
Process: Processing data from Source 2 41MB / 41MB...
Process: Processing data from Source 3 18MB / 18MB...
Process: Processing data from Source 4 37MB / 37MB...
Process: Processing data from Source 5 15MB / 15MB...
Process: Processing data from Source 6 1MB / 1MB...
Process: Processing data from Source 7 7MB / 7MB...
Process: Processing data from Source 8 29MB / 29MB...
Process: Processing data from Source 9 3MB / 3MB...
Process: Processing data from Source 10 38MB / 38MB...
Process: Processing data from Source 11 26MB / 26MB...
Process: Processing data from Source 12 8MB / 8MB...
Process: Processing data from Source 13 8MB / 8MB...
Process: Processing data from Source 14 37MB / 37MB...
Process: Processing data from Source 15 46MB / 46MB...
Process: Processing data from Source 16 35MB / 35MB...
Process: Processing data from Source 17 15MB / 15MB...
Process: Processing data from Source 18 7MB / 7MB...
Process: Processing data from Source 19 45MB / 45MB...
Process: Processing data from Source 20 47MB / 47MB...
Process: Processing data from Source 21 17MB / 17MB...
Process: Processing data from Source 22 7MB / 7MB...
Process: Processing data from Source 23 16MB / 16MB...
Process: Processing data from Source 24 42MB / 42MB...
Process: Processing data from Source 25 2MB / 2MB...
Process: Processing data from Source 26 5MB / 5MB...
Process: Processing data from Source 27 12MB / 12MB...
Process: Processing data from Source 28 8MB / 8MB...
Process: Processing data from Source 29 9MB / 9MB...
Process: Processing data from Source 30 17MB / 17MB...
Process: Processing data from Source 31 44MB / 44MB...
Process: Processing data from Source 32 30MB / 30MB...
Process: Processing data from Source 33 31MB / 31MB...
Process: Processing data from Source 34 14MB / 14MB...
Process: Processing data from Source 35 23MB / 23MB...
Process: Processing data from Source 36 24MB / 24MB...
Process: Processing data from Source 37 38MB / 38MB...
Process: Processing data from Source 38 10MB / 10MB...
Process: Processing data from Source 39 22MB / 22MB...
Process: Processing data from Source 40 32MB / 32MB...
Process: Processing data from Source 41 15MB / 15MB...
Process: Processing data from Source 42 2MB / 2MB...
Process: Processing data from Source 43 20MB / 20MB...
Process: Processing data from Source 44 31MB / 31MB...
Process: Processing data from Source 45 12MB / 12MB...
Process: Processing data from Source 46 27MB / 27MB...
Process: Processing data from Source 47 15MB / 15MB...
Process: Processing data from Source 48 46MB / 46MB...
Process: Processing data from Source 49 30MB / 30MB...
Process: Processing data from Source 50 18MB / 18MB...
All downloads and processes completed!!!

Process finished with exit code 0.
```
